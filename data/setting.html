<!DOCTYPE html>
<html charset="UTF-8">
  <head>
    <meta name="viewport" content="width=device-width,height=device-height,initial-scale=1">
      <style>
          body {
              text-align: center;
              margin: 0;
          }
          textarea {
            font-size: 0.9rem;
            letter-spacing: 1px;
            padding: 10px;
            line-height: 1.5;
            border-radius: 5px;
            border: 1px solid #555;
            box-shadow: 1px 1px 1px #999;
            resize: none;
        }
        fieldset {
            margin: 0 auto;
            width: 400px;
            padding: 1em;
            border: 3px solid rgba(0,0,200,0.6);
            border-radius: 1em;
            box-shadow: 11px 11px 15px rgba(0,0,200,0.4);
            background: rgba( 148,187,233,.95);
                        
        }
        a, input.tasto, input.tastoRST, legend{
              font-size: 1em;
              letter-spacing: 1px;
              text-transform: uppercase;
              text-align: center;
              border: 2px solid rgba(0,0,200,0.6);
              background: lightgray;
              color: rgba(0,0,200,0.6);
              box-shadow: 1px 1px 2px rgba(0,255,250,0.4);
              border-radius: 10px;
              padding: 3px 10px;
              display: inline-block;
              cursor: default;
        }
        a:hover, input.tasto:hover {
                color: green;
                box-shadow: 7px 7px 8px rgba(0,200,0,0.4);
                cursor: pointer;
            }
       p {
          letter-spacing: 1px;
          text-transform: uppercase;
          text-align: left;
          border: 1px solid gray;
          background: lightgray;
          color: rgba(0,0,200,0.6);
          box-shadow: 1px 1px 2px rgba(0,0,200,0.4);
          border-radius: 10px;
          padding: 3px 10px;
          display: inline-block;
          cursor: default;
        } 
       p.boardname{
            color: blueviolet;      
       }
       
       p.ip {
          color: green;
          }  
       p.rssi{
          color: red;
       }
       h1.intestazione{
            
            letter-spacing: 1px;
            text-transform: uppercase;
            border-radius: 1em;
            box-shadow: 11px 11px 15px rgba(200,200,200,0.4);
            margin: 0 auto;
            text-align: center; 
            font-family: 'helvetica neue', helvetica, sans-serif;
            color: lightgray;
            padding: 10px; 
            border: 3px solid black; 
            background: rgba(20,200,200,1);
            transform: translatey(5px);
            stroke: green;
            stroke-width: 2;
        }
        h1.linea {
            padding: 5px; 
            background: linear-gradient(to left, #e0e0e0 0%,#00172f 100%);
            transform: translatey(-15px);
        }
        #background {
          width: 100vw;
          height: 100vh;
          display: block;
          position: fixed;
          left: 0;
          top: 0;
          z-index: -1;
          pointer-events: none;
          border: none;
        }
      </style>
  </head>
  <body>
    <iframe id="background" src="https://threejsfundamentals.org/threejs/threejs-responsive.html"></iframe>
      <h1 class="intestazione"  >--- Setting Page ---</h1>
    <br>
    <br>
    <fieldset>
      <legend style="text-align: left;"><strong> Parameters </strong></legend>    
      <p id="ip" class="ip" title="IP address">
        IP
      </p>           
      <p id="boardname" class="boardname" title="Board name">
        Board Name
      </p>           
      <textarea id="infotextarea" rows="5" cols="50" disabled=true placeholder="info :/" title="Info system area"></textarea>
        
      <p id="rssi" class="rssi" title="WiFi signal strength">
      RSSI
      </p>
      <p id="ssid" class="ssid" title="WiFi network name">
      SSID
      </p>
      <p id="temp" class="temp" title="Temperature">
      tTEMP
      </p>
      <p id="humid" class="humid" title="Humidity">
      HUM
      </p>        
    </fieldset> 
      <br>
    <fieldset>
      <legend style="text-align: left;"><strong> File Manager </strong></legend>
      <form id="formUpload" action="upload" method="post" enctype="multipart/form-data">
         <fieldset style="box-shadow: none;">
            <legend style=" text-align: left; "> SPIFFS Directory </legend>
            <textarea id="dirtextarea" rows="5" cols="50" disabled=true placeholder="dir :/"></textarea>
        </fieldset>
        <br>
        <fieldset style="box-shadow: none;">
            <legend style=" text-align: left; "> Files upload </legend>
            <input id="filename" type="file" name="name" required=true>
            
            <input id="tastofile" class="tasto" type="submit" value="Upload">
            
          </fieldset>   
      </form>
    </fieldset> 
    <br>
    <form action="login" method="get">
            <input type="submit" value="Back" class="tasto">
    </form>
    <form action="reset" method="get">
            <input type="submit" value="RESET" class="tastoRST" disabled="true">
    </form>  
    <script>
  	     const form        = document.getElementById('formUpload');
         const fileName    = document.getElementById('filename');
         const dirTextArea = document.getElementById('dirtextarea');
         const ipAdress    = document.getElementById('ip');     
         const infTextArea = document.getElementById('infotextarea');
         const rssi        = document.getElementById('rssi');
         const ssid        = document.getElementById('ssid');
         const boardName   = document.getElementById('boardname');
         const temp        = document.getElementById('temp');
         const humid       = document.getElementById('humid'); 
        
        
         var uniqueURL = "/directory";
        
         refresh();
         setInterval(refresh, 2000 );
        
        function refresh (){
            fetch(uniqueURL).then(function(response) { // get metodo
                 return response.json();
             }).then(function (json) {
                    let textArea = "dir:\ \n";
                    const dir = json['dir'];
                    for (let i=0; i<dir.length;i++){
                        let br="\n";
                        if (i===(dir.length-1)) br=""; // se è ultimo elemento non metti il capo linea (-1 perchè parte da 0 l'indice)
                        textArea += dir[i].file[0]+" - "+ dir[i].file[1] + br;
                    }
                    dirTextArea.value = textArea;

                    ipAdress.textContent = "IP: " + json['ip'];
                    rssi.textContent     = "RSSI:  " + json['RSSI'] + " db";
                    ssid.textContent     = "SSId:  " + json['SSID'] ;
                    boardName.textContent= "Board: " + json['Board_Name']; 
                    temp.textContent     = "Temp.: " + json['Temperature'] + "°C";
                    humid.textContent    = "Humid.: " + json['Humidity'] + "%"; 

                    textArea ="Info system: \n";
                    const sysinfo = json['infosys'];  // indico 
                    for (let i = 0; i<sysinfo.length; i++) {
                        let br="\n";
                        let strForCount = '';
                        // trova la parola Count 
                        if (sysinfo[i].indexOf('Count')!== -1) { //se il campo è quello giusto (non è diversa) 
                            let stringa= sysinfo[i].slice(7); // metti nella variabile stringa l'ultima parte  
                            //quindi converti in int, fai i calcoli e metti tutto in strForCount
                            strForCount = ' (' + String(parseInt(stringa)/159500000*100).slice(0,4)+'%)';
                        }
                        if (i===(sysinfo.length-1)) br=""; // se è ultimo elemento non metti il capo linea (-1 perchè parte da 0 l'indice)
                        textArea += sysinfo[i]+strForCount+br;    
                    }
                    infTextArea.value = textArea;    

                 }).catch (function (err) {
                    console.log('Fetch problem: ' + err.message);

             });
        }
        /*  
        var request   = new XMLHttpRequest();
         
        request.onreadystatechange = function() {
            if (this.readyState == 4) {
                if (this.status == 200) {
                    if (this.responseText!=null) {
                        document.getElementById("dirtextarea").innerHTML = this.responseText;
                    }
                }
            }
        }
        request.open("POST", uniqueURL, false);
        request.send();
  */      
    </script>
  </body>
</html>

